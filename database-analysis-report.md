# æ‹è¯­AIæ•°æ®åº“åˆ†ææŠ¥å‘Š

## ğŸ“Š æ•°æ®åº“æ¦‚è§ˆ

### åŸºæœ¬ç»Ÿè®¡
- **ç”¨æˆ·æ€»æ•°**: 52 ä¸ªæ³¨å†Œç”¨æˆ·
- **ä¼šè¯æ€»æ•°**: 0 ä¸ªèŠå¤©ä¼šè¯
- **æ¶ˆæ¯æ€»æ•°**: 0 æ¡èŠå¤©æ¶ˆæ¯
- **æ•°æ®åº“çŠ¶æ€**: æ­£å¸¸è¿è¡Œï¼Œä½†ç¼ºå°‘å®é™…ä½¿ç”¨æ•°æ®

### ğŸ› ï¸ æ–°å¢ç®¡ç†å·¥å…·
æœ¬æ¬¡åˆ†æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€å¥—å®Œæ•´çš„æ•°æ®åº“ç®¡ç†è„šæœ¬å·¥å…·é›†ï¼Œä½äº `/scripts/` ç›®å½•ä¸‹ï¼š

1. **`view-database-data.js`** - åŸºç¡€æ•°æ®æŸ¥çœ‹å™¨
2. **`user-profile-manager.js`** - ç”¨æˆ·ä¸ªäººèµ„æ–™ç®¡ç†å™¨
3. **`chat-session-analyzer.js`** - èŠå¤©ä¼šè¯åˆ†æå™¨
4. **`database-maintenance.js`** - æ•°æ®åº“ç»´æŠ¤å·¥å…·
5. **`README.md`** - å®Œæ•´çš„ä½¿ç”¨è¯´æ˜æ–‡æ¡£

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„

### 1. users è¡¨ï¼ˆç”¨æˆ·è¡¨ï¼‰
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR NOT NULL,
    password_hash VARCHAR,
    email VARCHAR,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**å­—æ®µè¯´æ˜ï¼š**
- `id`: ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦
- `username`: ç”¨æˆ·å
- `password_hash`: å¯†ç å“ˆå¸Œå€¼
- `email`: ç”¨æˆ·é‚®ç®±
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´

**ç´¢å¼•å’Œçº¦æŸï¼š**
- ä¸»é”®ï¼š`users_pkey` (id)
- å”¯ä¸€ç´¢å¼•ï¼š`users_username_key` (username)
- å”¯ä¸€ç´¢å¼•ï¼š`users_email_key` (email)

### 2. sessions è¡¨ï¼ˆä¼šè¯è¡¨ï¼‰
```sql
CREATE TABLE sessions (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    title VARCHAR,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**å­—æ®µè¯´æ˜ï¼š**
- `id`: ä¼šè¯å”¯ä¸€æ ‡è¯†ç¬¦
- `user_id`: å…³è”çš„ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
- `title`: ä¼šè¯æ ‡é¢˜
- `created_at`: åˆ›å»ºæ—¶é—´
- `updated_at`: æ›´æ–°æ—¶é—´

**ç´¢å¼•å’Œçº¦æŸï¼š**
- ä¸»é”®ï¼š`sessions_pkey` (id)
- å¤–é”®ï¼š`sessions_user_id_fkey` (user_id â†’ users.id)
- ç´¢å¼•ï¼š`idx_sessions_user_id` (user_id)

### 3. messages è¡¨ï¼ˆæ¶ˆæ¯è¡¨ï¼‰
```sql
CREATE TABLE messages (
    id SERIAL PRIMARY KEY,
    session_id INTEGER REFERENCES sessions(id),
    role VARCHAR NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**å­—æ®µè¯´æ˜ï¼š**
- `id`: æ¶ˆæ¯å”¯ä¸€æ ‡è¯†ç¬¦
- `session_id`: å…³è”çš„ä¼šè¯IDï¼ˆå¤–é”®ï¼‰
- `role`: æ¶ˆæ¯è§’è‰²ï¼ˆ'user' æˆ– 'assistant'ï¼‰
- `content`: æ¶ˆæ¯å†…å®¹
- `created_at`: åˆ›å»ºæ—¶é—´

**ç´¢å¼•å’Œçº¦æŸï¼š**
- ä¸»é”®ï¼š`messages_pkey` (id)
- å¤–é”®ï¼š`messages_session_id_fkey` (session_id â†’ sessions.id)
- ç´¢å¼•ï¼š`idx_messages_session_id` (session_id)
- ç´¢å¼•ï¼š`idx_messages_created_at` (created_at)

## ğŸ‘¥ ç”¨æˆ·æ•°æ®åˆ†æ

### æœ€æ–°ç”¨æˆ·æ•°æ®ï¼ˆå‰10ä¸ªï¼‰
| ID | ç”¨æˆ·å | é‚®ç®± | æ³¨å†Œæ—¶é—´ |
|----|--------|------|----------|
| 52 | user$(date +%s) | email$(date +%s)@example.com | 2024-12-19 |
| 51 | user$(date +%s) | email$(date +%s)@example.com | 2024-12-19 |
| 50 | user$(date +%s) | email$(date +%s)@example.com | 2024-12-19 |
| 49 | user$(date +%s) | email$(date +%s)@example.com | 2024-12-19 |
| 48 | user$(date +%s) | email$(date +%s)@example.com | 2024-12-19 |
| 47 | user$(date +%s) | email$(date +%s)@example.com | 2024-12-19 |
| 46 | user$(date +%s) | email$(date +%s)@example.com | 2024-12-19 |
| 45 | user$(date +%s) | email$(date +%s)@example.com | 2024-12-19 |
| 44 | user$(date +%s) | email$(date +%s)@example.com | 2024-12-19 |
| 43 | user$(date +%s) | email$(date +%s)@example.com | 2024-12-19 |

### ç”¨æˆ·æ•°æ®ç‰¹å¾
1. **æ³¨å†Œæ¨¡å¼**: æ‰€æœ‰ç”¨æˆ·éƒ½åœ¨åŒä¸€å¤©ï¼ˆ2024-12-19ï¼‰æ³¨å†Œ
2. **ç”¨æˆ·åæ ¼å¼**: ä½¿ç”¨äº† `user$(date +%s)` çš„æ¨¡å¼ï¼Œè¡¨æ˜è¿™äº›æ˜¯æµ‹è¯•æ•°æ®
3. **é‚®ç®±æ ¼å¼**: ä½¿ç”¨äº† `email$(date +%s)@example.com` çš„æ¨¡å¼ï¼ŒåŒæ ·æ˜¯æµ‹è¯•æ•°æ®
4. **æ•°æ®è´¨é‡**: æ‰€æœ‰ç”¨æˆ·æ•°æ®éƒ½æ˜¯ç¨‹åºç”Ÿæˆçš„æµ‹è¯•æ•°æ®ï¼Œæ²¡æœ‰çœŸå®ç”¨æˆ·

## ğŸ’¬ èŠå¤©å†å²æ•°æ®åˆ†æ

### ä¼šè¯æ•°æ®
- **æ€»ä¼šè¯æ•°**: 0
- **æ´»è·ƒä¼šè¯**: 0
- **å¹³å‡ä¼šè¯é•¿åº¦**: N/A

### æ¶ˆæ¯æ•°æ®
- **æ€»æ¶ˆæ¯æ•°**: 0
- **ç”¨æˆ·æ¶ˆæ¯**: 0
- **AIå›å¤**: 0
- **å¹³å‡æ¶ˆæ¯é•¿åº¦**: N/A

### åˆ†æç»“è®º
ç›®å‰ç³»ç»Ÿä¸­æ²¡æœ‰ä»»ä½•å®é™…çš„èŠå¤©ä¼šè¯å’Œæ¶ˆæ¯æ•°æ®ï¼Œè¡¨æ˜ï¼š
1. ç³»ç»Ÿå¯èƒ½åˆšåˆšéƒ¨ç½²ï¼Œè¿˜æ²¡æœ‰çœŸå®ç”¨æˆ·ä½¿ç”¨
2. æˆ–è€…å­˜åœ¨åŠŸèƒ½é—®é¢˜å¯¼è‡´ä¼šè¯æ•°æ®æ— æ³•æ­£å¸¸ä¿å­˜
3. éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥å‰ç«¯å’Œåç«¯çš„ä¼šè¯åˆ›å»ºé€»è¾‘

## ğŸ“ˆ æ•°æ®è´¨é‡è¯„ä¼°

### âœ… ä¼˜ç‚¹
1. **æ•°æ®åº“ç»“æ„å®Œæ•´**: æ‰€æœ‰å¿…éœ€çš„è¡¨éƒ½å­˜åœ¨ä¸”ç»“æ„æ­£ç¡®
2. **å¤–é”®å…³ç³»æ­£ç¡®**: è¡¨ä¹‹é—´çš„å…³è”å…³ç³»è®¾ç½®æ­£ç¡®
3. **ç´¢å¼•é…ç½®åˆç†**: å…³é”®å­—æ®µéƒ½æœ‰é€‚å½“çš„ç´¢å¼•
4. **æ•°æ®ç±»å‹é€‚å½“**: å­—æ®µç±»å‹é€‰æ‹©åˆç†
5. **çº¦æŸè®¾ç½®å®Œå–„**: ä¸»é”®ã€å¤–é”®ã€å”¯ä¸€çº¦æŸéƒ½è®¾ç½®æ­£ç¡®

### âš ï¸ é—®é¢˜
1. **æµ‹è¯•æ•°æ®æ±¡æŸ“**: æ‰€æœ‰ç”¨æˆ·æ•°æ®éƒ½æ˜¯æµ‹è¯•æ•°æ®ï¼Œéœ€è¦æ¸…ç†
2. **ç¼ºå°‘çœŸå®æ•°æ®**: æ²¡æœ‰å®é™…çš„ä½¿ç”¨æ•°æ®ï¼Œæ— æ³•è¯„ä¼°ç³»ç»Ÿæ€§èƒ½
3. **æ•°æ®ä¸ä¸€è‡´**: ç”¨æˆ·åå’Œé‚®ç®±ä½¿ç”¨äº†shellå‘½ä»¤æ ¼å¼ï¼Œæ˜¾ç„¶æ˜¯é”™è¯¯çš„
4. **åŠŸèƒ½éªŒè¯ä¸è¶³**: æ— æ³•éªŒè¯èŠå¤©åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ

## ğŸ”§ å»ºè®®å’Œæ”¹è¿›æ–¹æ¡ˆ

### 1. ç«‹å³è¡ŒåŠ¨é¡¹

#### æ¸…ç†æµ‹è¯•æ•°æ®
```bash
# ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„ç”¨æˆ·ç®¡ç†è„šæœ¬æ¸…ç†æµ‹è¯•ç”¨æˆ·
node scripts/user-profile-manager.js cleanup --no-dry-run
```

#### éªŒè¯ç³»ç»ŸåŠŸèƒ½
1. æµ‹è¯•ç”¨æˆ·æ³¨å†Œæµç¨‹
2. æµ‹è¯•èŠå¤©ä¼šè¯åˆ›å»º
3. æµ‹è¯•æ¶ˆæ¯å‘é€å’Œæ¥æ”¶
4. æ£€æŸ¥æ•°æ®æ˜¯å¦æ­£ç¡®ä¿å­˜

### 2. æ•°æ®åº“ä¼˜åŒ–

#### æ€§èƒ½ä¼˜åŒ–
```bash
# ä½¿ç”¨æ•°æ®åº“ç»´æŠ¤è„šæœ¬è¿›è¡Œä¼˜åŒ–
node scripts/database-maintenance.js optimize
```

#### å¥åº·æ£€æŸ¥
```bash
# å®šæœŸè¿›è¡Œå¥åº·æ£€æŸ¥
node scripts/database-maintenance.js health
```

### 3. ç›‘æ§å’Œç»´æŠ¤

#### å®šæœŸå¤‡ä»½
```bash
# è®¾ç½®è‡ªåŠ¨å¤‡ä»½
node scripts/database-maintenance.js backup
```

#### æ•°æ®åˆ†æ
```bash
# å®šæœŸåˆ†æç”¨æˆ·è¡Œä¸º
node scripts/user-profile-manager.js stats
node scripts/chat-session-analyzer.js analyze
```

### 4. é•¿æœŸæ”¹è¿›

#### æ•°æ®éªŒè¯
1. æ·»åŠ ç”¨æˆ·è¾“å…¥éªŒè¯
2. å®ç°æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
3. æ·»åŠ å¼‚å¸¸æ•°æ®ç›‘æ§

#### æ€§èƒ½ç›‘æ§
1. å®ç°æŸ¥è¯¢æ€§èƒ½ç›‘æ§
2. æ·»åŠ æ…¢æŸ¥è¯¢æ—¥å¿—
3. å®šæœŸæ€§èƒ½è¯„ä¼°

#### å®‰å…¨åŠ å›º
1. å®ç°æ•°æ®åŠ å¯†
2. æ·»åŠ è®¿é—®æ§åˆ¶
3. å®šæœŸå®‰å…¨å®¡è®¡

## ğŸ› ï¸ æŠ€æœ¯å®ç°ç»†èŠ‚

### æ•°æ®åº“è¿æ¥é…ç½®
```javascript
const dbConfig = {
  user: process.env.DB_USER || 'lianyu_user',
  host: process.env.DB_HOST || 'localhost',
  database: process.env.DB_NAME || 'lianyu_ai',
  password: process.env.DB_PASSWORD || 'lianyu_secure_password_2024',
  port: process.env.DB_PORT || 5432,
};
```

### ç®¡ç†è„šæœ¬åŠŸèƒ½

#### ç”¨æˆ·ç®¡ç†
- ç”¨æˆ·åˆ—è¡¨æŸ¥çœ‹ï¼ˆåˆ†é¡µã€æœç´¢ï¼‰
- ç”¨æˆ·è¯¦æƒ…æŸ¥çœ‹ï¼ˆåŒ…å«ç»Ÿè®¡ä¿¡æ¯ï¼‰
- ç”¨æˆ·æ•°æ®å¯¼å‡ºï¼ˆå¤šç§æ ¼å¼ï¼‰
- æµ‹è¯•ç”¨æˆ·æ¸…ç†
- ç”¨æˆ·ç»Ÿè®¡åˆ†æ

#### ä¼šè¯åˆ†æ
- ä¼šè¯åˆ—è¡¨æŸ¥çœ‹
- ä¼šè¯è¯¦æƒ…åˆ†æ
- èŠå¤©æ¨¡å¼åˆ†æ
- æ´»åŠ¨æ—¶é—´åˆ†æ
- ä¼šè¯é•¿åº¦åˆ†å¸ƒ

#### æ•°æ®åº“ç»´æŠ¤
- è‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤
- å¥åº·çŠ¶æ€æ£€æŸ¥
- æ€§èƒ½ä¼˜åŒ–
- æ—§æ•°æ®æ¸…ç†
- æ•°æ®å®Œæ•´æ€§éªŒè¯

### ä½¿ç”¨ç¤ºä¾‹

#### æ—¥å¸¸ç®¡ç†
```bash
# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
node scripts/database-maintenance.js health

# æŸ¥çœ‹ç”¨æˆ·ç»Ÿè®¡
node scripts/user-profile-manager.js stats

# åˆ†æèŠå¤©æ¨¡å¼
node scripts/chat-session-analyzer.js analyze
```

#### æ•°æ®å¯¼å‡º
```bash
# å¯¼å‡ºç”¨æˆ·æ•°æ®
node scripts/user-profile-manager.js export csv ./users.csv

# å¯¼å‡ºä¼šè¯æ•°æ®
node scripts/chat-session-analyzer.js export json ./sessions.json
```

#### ç»´æŠ¤æ“ä½œ
```bash
# åˆ›å»ºå¤‡ä»½
node scripts/database-maintenance.js backup

# æ¸…ç†æ—§æ•°æ®
node scripts/database-maintenance.js cleanup-old 90

# ä¼˜åŒ–æ•°æ®åº“
node scripts/database-maintenance.js optimize
```

## ğŸ“‹ æ€»ç»“

### å½“å‰çŠ¶æ€
- âœ… æ•°æ®åº“ç»“æ„å®Œæ•´ä¸”æ­£ç¡®
- âœ… æœ‰52ä¸ªæ³¨å†Œç”¨æˆ·ï¼ˆä½†éƒ½æ˜¯æµ‹è¯•æ•°æ®ï¼‰
- âŒ ç¼ºå°‘å®é™…çš„èŠå¤©ä¼šè¯å’Œæ¶ˆæ¯æ•°æ®
- âŒ æµ‹è¯•æ•°æ®éœ€è¦æ¸…ç†

### å·²å®Œæˆå·¥ä½œ
- âœ… åˆ›å»ºäº†å®Œæ•´çš„æ•°æ®åº“ç®¡ç†è„šæœ¬å·¥å…·é›†
- âœ… å®ç°äº†ç”¨æˆ·ç®¡ç†åŠŸèƒ½
- âœ… å®ç°äº†ä¼šè¯åˆ†æåŠŸèƒ½
- âœ… å®ç°äº†æ•°æ®åº“ç»´æŠ¤åŠŸèƒ½
- âœ… æä¾›äº†è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. **æ¸…ç†æµ‹è¯•æ•°æ®** - ä½¿ç”¨åˆ›å»ºçš„è„šæœ¬æ¸…ç†æ‰€æœ‰æµ‹è¯•ç”¨æˆ·
2. **åŠŸèƒ½éªŒè¯** - æµ‹è¯•ç³»ç»Ÿçš„èŠå¤©åŠŸèƒ½æ˜¯å¦æ­£å¸¸
3. **çœŸå®æ•°æ®æ”¶é›†** - å¼€å§‹æ”¶é›†çœŸå®çš„ç”¨æˆ·ä½¿ç”¨æ•°æ®
4. **ç›‘æ§éƒ¨ç½²** - éƒ¨ç½²å®šæœŸçš„å¥åº·æ£€æŸ¥å’Œå¤‡ä»½
5. **æ€§èƒ½ä¼˜åŒ–** - æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè¿›è¡Œæ€§èƒ½è°ƒä¼˜

é€šè¿‡è¿™å¥—å®Œæ•´çš„æ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œæ‹è¯­AIç³»ç»Ÿç°åœ¨å…·å¤‡äº†ä¸“ä¸šçº§çš„æ•°æ®åº“ç®¡ç†å’Œåˆ†æèƒ½åŠ›ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç›‘æ§ç³»ç»ŸçŠ¶æ€ã€ç®¡ç†ç”¨æˆ·æ•°æ®ã€åˆ†æä½¿ç”¨æ¨¡å¼ï¼Œå¹¶ç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2024å¹´12æœˆ19æ—¥  
**æ•°æ®åº“ç‰ˆæœ¬**: PostgreSQL  
**åˆ†æå·¥å…·**: è‡ªå®šä¹‰Node.jsè„šæœ¬é›†åˆ  
**çŠ¶æ€**: æ•°æ®åº“ç»“æ„æ­£å¸¸ï¼Œç­‰å¾…çœŸå®æ•°æ®éªŒè¯